
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="小白的文件整理箱">
    <title>Elasticsearch查询语句使用 - 小白的文件整理箱</title>
    <meta name="author" content="小白的文件整理箱">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/unknown_404/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"小白的文件整理箱","sameAs":["https://github.com/","http://stackoverflow.com/users"],"image":"cover.jpg"},"articleBody":"\n\nes 中的查询请求有两种方式，一种是简易版的查询，另外一种是使用 JSON 完整的请求体，叫做结构化查询（DSL）。DSL 的查询方式是 POST 过去一个 json，由于 post 的请求是 json 格式的，所以存在很多灵活性，也有很多形式。笔者出于使用 nodejs 技术调用 es 查询的需求，因此主要搜集的资料是关于 DSL 的。\n本文并不是查询方法的全列举，而是针对自己实际使用的几种方法进行比较辨析。如果日后尝试使用其他方法，也会在这里添加补充说明。\n使用 DSL 查询语法时，由于使用 json 字符串时存在特殊符号例如*,/,\\等影响解析，因此需要使用两个反斜杠\\\\进行转义\n\n\n123const calcQueryString=(keyword:string)=&gt;&#123;    return keyword.replace(/([-\\/\\\\^$*+?.()|[\\]&#123;&#125;])/g, &#x27;\\\\$1&#x27;);&#125;\n\n全文查询match不需要完整的卢塞恩语法支持。在查询语句里任何一个词项与分词匹配都会返回该文档。如果要查询所有关键词的文档，可以使用 and 操作符连接。结果里关键词但次序无法保证。\n查询结构示例：\n1234567&#123;  &quot;query&quot;: &#123;    &quot;match&quot;: &#123;        &quot;content&quot; : &quot;小白的文件整理箱&quot;    &#125;  &#125;&#125;\n\n该查询语句可能根据分词规则分为“小白”、“白的”、“文”、“整理箱”等多种关键词，只要有匹配的字词就会被搜出来，例如“文无定法”、“文小白”等都有可能\nmatch_phrase在执行短语匹配查询时，查询结果会满足两个条件：1）必须匹配短语中的所有分词 2）保证各个分词的相对位置不变。\n以 match 的查询语句为例，查询结果不会出现“文小白”，但有可能出现“小白菜的 zip 文件垃圾整理行李箱”\nmulti_matchmatch 语法的升级，可用于多个字段。也可以用指数符指定多个字段的权重\n查询结构示例：\n12345678&#123;  &quot;query&quot;: &#123;    &quot;multi_match&quot;: &#123;        &quot;query&quot; : &quot;小白的文件整理箱&quot;,        &quot;fields&quot;:[&quot;title^3&quot;,&quot;content&quot;]    &#125;  &#125;&#125;\n\nquery_string常见写法：\n12345678&#123;  &quot;query&quot;: &#123;    &quot;query_string&quot;: &#123;      &quot;query&quot;: &quot;(new york city) OR (big apple)&quot;,      &quot;fields&quot;: [&quot;content&quot;]    &#125;  &#125;&#125;\n\n支持运算符 AND 和 OR，括号内的查询语句作为整个查询。支持 wildcard 语法。\n词项查询termterm 是代表完全匹配，返回的文件必须包含完整的关键词。\ntermsterm 的升级版，可以查询多个字词。例如查询 content 字段包含“小白”和“文件整理箱”的文档。\n查询结构示例：\n1234567&#123;  &quot;query&quot;: &#123;    &quot;terms&quot;: &#123;        &quot;content&quot; : [&quot;小白&quot;,&quot;文件整理箱&quot;]    &#125;  &#125;&#125;\nprefix查询某个字段以固定前缀开始的文档。\n1234567&#123;  &quot;query&quot;: &#123;    &quot;prefix&quot;: &#123;        &quot;content&quot; : &quot;小白&quot;    &#125;  &#125;&#125;\n该查询语句会返回“小白”、“小白菜”等所有以“小白”开头的content文档。\nwildcard支持通配符搜索，可以使用?替换单个字符，用*替换零个或多个字符。通配符的查询效率较低不是很推荐。\nregexp可以支持更为复杂的匹配模式。（个人体验感觉不佳，用于带转义字段的查询时往往查不到，不知道什么原因；不如js的正则好用）\n1234567&#123;    &quot;query&quot;: &#123;        &quot;regexp&quot;: &#123;            &quot;postcode&quot;: &quot;W[0-9].+&quot;         &#125;    &#125;&#125;\n查询语句text字段和keyword字段的区别ElasticSearch 5.0以后，String字段被拆分成两种新的数据类型: text用于全文搜索，会分词,而keyword用于关键词搜索，不进行分词。对于字符串类型的字段，ES默认会再生成一个keyword字段用于精确索引。\n简单理解就是text字段会被分词，而keyword字段是要求不分词完整地查找全字段。\nkeyword的查询语句如下：\n1234567&#123;  &quot;query&quot;: &#123;    &quot;term&quot;: &#123;        &quot;content.keyword&quot; : &quot;小白&quot;    &#125;  &#125;&#125;\n\n查询字段时 term、match、match_phrase、query_string 的区别1.1 term1）term 查询 keyword 字段。\nterm 不会分词。而 keyword 字段也不分词。需要完全匹配才可。\n2）term 查询 text 字段\n因为 text 字段会分词，而 term 不分词，所以 term 查询的条件必须是 text 字段分词后的某一个。\neg. brown big box 作为 text 字段会被分为[ brown, big, box ]的词组，当 term 的查询内容为 brown 时可返回该词条当 term 的查询内容为 brown big 的时候则不会返回\n1.2 match1）match 查询 keyword 字段\nmatch 会被分词，而 keyword 不会被分词，match 的需要跟 keyword 的完全匹配可以。\n其他的不完全匹配的都是失败的。\n2）match 查询 text 字段\nmatch 分词，text 也分词，只要 match 的分词结果和 text 的分词结果有相同的就匹配。\neg. brown big box 的词条，当 term 的查询内容为 fox 时也可返回该词条，因为存在“ox“这一相同内容\n1.3.match_phrase1）match_phrase 匹配 keyword 字段。\n这个同上必须跟 keyword 一致才可以。\n2）match_phrase 匹配 text 字段。\nmatch_phrase 是分词的，text 也是分词的。match_phrase 的分词结果必须在 text 字段分词中都包含，而且顺序必须相同，而且必须都是连续的。\n（与 match 匹配 text 情况相比就多了顺序相同一个条件）\n1.4.query_string1）query_string 查询 keyword 类型的字段。\n网上有说法无法查询。但根据实际经验做长字符串的查询是可行的，可能是 Lucene 语法使用不当的问题。  \nquery_string 查询 keyword 字段如果只是使用了局部字段查询的话需要在前后加“*”。\n2）query_string 查询 text 类型的字段。\n和 match_phrase 区别的是，不需要连续，顺序还可以调换。\n参考资料（1）Elasticsearch Guide（2）《从Lucene到ElasticSearch：全文检索实战》（3）ES之五：关于Elasticsearch查找相关的问题汇总（match、match_phrase、query_string和term）（4）elasticsearch 查询（match和term）\n","dateCreated":"2022-03-14T20:43:59+08:00","dateModified":"2022-03-18T18:45:49+08:00","datePublished":"2022-03-14T20:43:59+08:00","description":"摸索Elasticsearch查询语句时搜索和实践体验到的知识点","headline":"Elasticsearch查询语句使用","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"},"publisher":{"@type":"Organization","name":"小白的文件整理箱","sameAs":["https://github.com/","http://stackoverflow.com/users"],"image":"cover.jpg","logo":{"@type":"ImageObject","url":"cover.jpg"}},"url":"https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/","keywords":"Elasticsearch"}</script>
    <meta name="description" content="摸索Elasticsearch查询语句时搜索和实践体验到的知识点">
<meta property="og:type" content="blog">
<meta property="og:title" content="Elasticsearch查询语句使用">
<meta property="og:url" content="https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/index.html">
<meta property="og:site_name" content="小白的文件整理箱">
<meta property="og:description" content="摸索Elasticsearch查询语句时搜索和实践体验到的知识点">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-03-14T12:43:59.000Z">
<meta property="article:modified_time" content="2022-03-18T10:45:49.166Z">
<meta property="article:author" content="小白的文件整理箱">
<meta property="article:tag" content="Elasticsearch">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://unknown-four-hundred-and-four.gitee.io/unknown_404/assets/images/cover.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/unknown_404/assets/css/style-vo5jmbxj15zt93zntj1ihwqzu9hdvmnmejczcuo2xhw61kjgn1r311vpwjcv.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/unknown_404/"
            aria-label=""
        >
            小白的文件整理箱
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /unknown_404/#about"
            >
        
        
            <img class="header-picture" src="/unknown_404/assets/images/cover.jpg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/unknown_404/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="/unknown_404/assets/images/cover.jpg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">小白的文件整理箱</h4>
                
                    <h5 class="sidebar-profile-bio"><p>名もない今日を愛しさで彩る〜</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/unknown_404/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/unknown_404/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/unknown_404/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/unknown_404/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜索"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Elasticsearch查询语句使用
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2022-03-14T20:43:59+08:00">
	
		    3月 14, 2022
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/unknown_404/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">技术学习</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%9F%A5%E8%AF%A2"><span class="toc-text">全文查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#match"><span class="toc-text">match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#match-phrase"><span class="toc-text">match_phrase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multi-match"><span class="toc-text">multi_match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#query-string"><span class="toc-text">query_string</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8D%E9%A1%B9%E6%9F%A5%E8%AF%A2"><span class="toc-text">词项查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#term"><span class="toc-text">term</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#terms"><span class="toc-text">terms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prefix"><span class="toc-text">prefix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wildcard"><span class="toc-text">wildcard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#regexp"><span class="toc-text">regexp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5text%E5%AD%97%E6%AE%B5%E5%92%8Ckeyword%E5%AD%97%E6%AE%B5%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">查询语句text字段和keyword字段的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%AD%97%E6%AE%B5%E6%97%B6-term%E3%80%81match%E3%80%81match-phrase%E3%80%81query-string-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">查询字段时 term、match、match_phrase、query_string 的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-term"><span class="toc-text">1.1 term</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-match"><span class="toc-text">1.2 match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-match-phrase"><span class="toc-text">1.3.match_phrase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-query-string"><span class="toc-text">1.4.query_string</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol>

<p>es 中的查询请求有两种方式，一种是简易版的查询，另外一种是使用 JSON 完整的请求体，叫做结构化查询（DSL）。DSL 的查询方式是 POST 过去一个 json，由于 post 的请求是 json 格式的，所以存在很多灵活性，也有很多形式。笔者出于使用 nodejs 技术调用 es 查询的需求，因此主要搜集的资料是关于 DSL 的。</p>
<p>本文并不是查询方法的全列举，而是针对自己实际使用的几种方法进行比较辨析。如果日后尝试使用其他方法，也会在这里添加补充说明。</p>
<div class="alert info"><p>使用 DSL 查询语法时，由于使用 json 字符串时存在特殊符号例如<code>*,/,\</code>等影响解析，因此需要使用两个反斜杠<code>\\</code>进行转义</p>
</div>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">calcQueryString</span>=(<span class="params">keyword:<span class="built_in">string</span></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> keyword.<span class="title function_">replace</span>(<span class="regexp">/([-\/\\^$*+?.()|[\]&#123;&#125;])/g</span>, <span class="string">&#x27;\\$1&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="全文查询"><a href="#全文查询" class="headerlink" title="全文查询"></a>全文查询</h2><h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><p>不需要完整的卢塞恩语法支持。在查询语句里任何一个词项与分词匹配都会返回该文档。如果要查询所有关键词的文档，可以使用 and 操作符连接。结果里关键词但次序无法保证。</p>
<p>查询结构示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">        &quot;content&quot; : &quot;小白的文件整理箱&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该查询语句可能根据分词规则分为“小白”、“白的”、“文”、“整理箱”等多种关键词，只要有匹配的字词就会被搜出来，例如“文无定法”、“文小白”等都有可能</p>
<h3 id="match-phrase"><a href="#match-phrase" class="headerlink" title="match_phrase"></a>match_phrase</h3><p>在执行短语匹配查询时，查询结果会满足两个条件：1）必须匹配短语中的所有分词 2）保证各个分词的相对位置不变。</p>
<p>以 match 的查询语句为例，查询结果不会出现“文小白”，但有可能出现“小白菜的 zip 文件垃圾整理行李箱”</p>
<h3 id="multi-match"><a href="#multi-match" class="headerlink" title="multi_match"></a>multi_match</h3><p>match 语法的升级，可用于多个字段。也可以用指数符指定多个字段的权重</p>
<p>查询结构示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">        &quot;query&quot; : &quot;小白的文件整理箱&quot;,</span><br><span class="line">        &quot;fields&quot;:[&quot;title^3&quot;,&quot;content&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="query-string"><a href="#query-string" class="headerlink" title="query_string"></a>query_string</h3><p>常见写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;(new york city) OR (big apple)&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;content&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>支持运算符 AND 和 OR，括号内的查询语句作为整个查询。<br>支持 wildcard 语法。</p>
<h2 id="词项查询"><a href="#词项查询" class="headerlink" title="词项查询"></a>词项查询</h2><h3 id="term"><a href="#term" class="headerlink" title="term"></a>term</h3><p>term 是代表完全匹配，返回的文件必须包含完整的关键词。</p>
<h3 id="terms"><a href="#terms" class="headerlink" title="terms"></a>terms</h3><p>term 的升级版，可以查询多个字词。例如查询 content 字段包含“小白”和“文件整理箱”的文档。</p>
<p>查询结构示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;content&quot; : [&quot;小白&quot;,&quot;文件整理箱&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="prefix"><a href="#prefix" class="headerlink" title="prefix"></a>prefix</h3><p>查询某个字段以固定前缀开始的文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &#123;</span><br><span class="line">        &quot;content&quot; : &quot;小白&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该查询语句会返回“小白”、“小白菜”等所有以“小白”开头的content文档。</p>
<h3 id="wildcard"><a href="#wildcard" class="headerlink" title="wildcard"></a>wildcard</h3><p>支持通配符搜索，可以使用?替换单个字符，用*替换零个或多个字符。通配符的查询效率较低不是很推荐。</p>
<h3 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h3><p>可以支持更为复杂的匹配模式。<em>（个人体验感觉不佳，用于带转义字段的查询时往往查不到，不知道什么原因；不如js的正则好用）</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;regexp&quot;: &#123;</span><br><span class="line">            &quot;postcode&quot;: &quot;W[0-9].+&quot; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="查询语句text字段和keyword字段的区别"><a href="#查询语句text字段和keyword字段的区别" class="headerlink" title="查询语句text字段和keyword字段的区别"></a>查询语句text字段和keyword字段的区别</h2><p>ElasticSearch 5.0以后，String字段被拆分成两种新的数据类型: text用于全文搜索，会分词,而keyword用于关键词搜索，不进行分词。对于字符串类型的字段，ES默认会再生成一个keyword字段用于精确索引。</p>
<p>简单理解就是text字段会被分词，而keyword字段是要求不分词完整地查找全字段。</p>
<p>keyword的查询语句如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">        &quot;content.keyword&quot; : &quot;小白&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询字段时-term、match、match-phrase、query-string-的区别"><a href="#查询字段时-term、match、match-phrase、query-string-的区别" class="headerlink" title="查询字段时 term、match、match_phrase、query_string 的区别"></a>查询字段时 term、match、match_phrase、query_string 的区别</h2><h3 id="1-1-term"><a href="#1-1-term" class="headerlink" title="1.1 term"></a>1.1 term</h3><p>1）term 查询 keyword 字段。</p>
<p>term 不会分词。而 keyword 字段也不分词。需要完全匹配才可。</p>
<p>2）term 查询 text 字段</p>
<p>因为 text 字段会分词，而 term 不分词，所以 term 查询的条件必须是 text 字段分词后的某一个。</p>
<p>eg. brown big box 作为 text 字段会被分为[ brown, big, box ]的词组，当 term 的查询内容为 brown 时可返回该词条<br>当 term 的查询内容为 brown big 的时候则不会返回</p>
<h3 id="1-2-match"><a href="#1-2-match" class="headerlink" title="1.2 match"></a>1.2 match</h3><p>1）match 查询 keyword 字段</p>
<p>match 会被分词，而 keyword 不会被分词，match 的需要跟 keyword 的完全匹配可以。</p>
<p>其他的不完全匹配的都是失败的。</p>
<p>2）match 查询 text 字段</p>
<p>match 分词，text 也分词，只要 match 的分词结果和 text 的分词结果有相同的就匹配。</p>
<p>eg. brown big box 的词条，当 term 的查询内容为 fox 时也可返回该词条，因为存在“ox“这一相同内容</p>
<h3 id="1-3-match-phrase"><a href="#1-3-match-phrase" class="headerlink" title="1.3.match_phrase"></a>1.3.match_phrase</h3><p>1）match_phrase 匹配 keyword 字段。</p>
<p>这个同上必须跟 keyword 一致才可以。</p>
<p>2）match_phrase 匹配 text 字段。</p>
<p>match_phrase 是分词的，text 也是分词的。match_phrase 的分词结果必须在 text 字段分词中都包含，而且顺序必须相同，而且必须都是连续的。</p>
<p><em>（与 match 匹配 text 情况相比就多了顺序相同一个条件）</em></p>
<h3 id="1-4-query-string"><a href="#1-4-query-string" class="headerlink" title="1.4.query_string"></a>1.4.query_string</h3><p>1）query_string 查询 keyword 类型的字段。</p>
<p>网上有说法无法查询。但根据实际经验做长字符串的查询是可行的，可能是 Lucene 语法使用不当的问题。  </p>
<p>query_string 查询 keyword 字段如果只是使用了局部字段查询的话需要在前后加“*”。</p>
<p>2）query_string 查询 text 类型的字段。</p>
<p>和 match_phrase 区别的是，不需要连续，顺序还可以调换。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>（1）<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html">Elasticsearch Guide</a><br>（2）《从Lucene到ElasticSearch：全文检索实战》<br>（3）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/duanxz/p/3508338.html">ES之五：关于Elasticsearch查找相关的问题汇总（match、match_phrase、query_string和term）</a><br>（4）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yjf512/p/4897294.html">elasticsearch 查询（match和term）</a></p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/unknown_404/tags/Elasticsearch/" rel="tag">Elasticsearch</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/unknown_404/2022/03/14/hexoBlog/"
                    data-tooltip="hexo搭建博客"
                    aria-label="下一篇: hexo搭建博客"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                    title="分享到 Google+"
                    aria-label="分享到 Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 小白的文件整理箱. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/unknown_404/2022/03/14/hexoBlog/"
                    data-tooltip="hexo搭建博客"
                    aria-label="下一篇: hexo搭建博客"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                    title="分享到 Facebook"
                    aria-label="分享到 Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                    title="分享到 Twitter"
                    aria-label="分享到 Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                    title="分享到 Google+"
                    aria-label="分享到 Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                        aria-label="分享到 Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                        aria-label="分享到 Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://unknown-four-hundred-and-four.gitee.io/unknown_404/2022/03/14/esUseage/"
                        aria-label="分享到 Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>分享到 Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/unknown_404/assets/images/cover.jpg" alt="作者的图片"/>
        
            <h4 id="about-card-name">小白的文件整理箱</h4>
        
            <div id="about-card-bio"><p>名もない今日を愛しさで彩る〜</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>菜鸟级摸鱼工程师</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Shadow Border
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/unknown_404/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/unknown_404/assets/js/script-irmmn5vm0sjepvpgu6objy6omsq5bczmrikvesy6zimdmfxahwktrnvtwcfk.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
