---
title: 小程序踩坑经历--feed乱流
date: 2023-06-30 11:49:48
categories:
  - 踩坑经历
tags:
  - 小程序
---

记录维护项目时碰到的问题。

<!-- more -->

## 问题描述

小程序的 feed 流内容带有关闭按钮，点击后该条目从 feed 流移除。但移除后后续条目的图片发生了错位。

## 原因分析

根据 skype 给出的提示，主要有几个可能：

1. [分页逻辑有问题，导致删除数据后，下一页的数据重复了上一页的数据](https://blog.csdn.net/u013633921/article/details/119922467)。可以尝试使用 last_id 来记录上一页最后一条数据的 id，然后根据这个 id 来获取下一页的数据，避免重复。

2. [删除操作没有正确更新页面的数据，导致页面显示的数据和数据库不一致](https://blog.csdn.net/qq_41930094/article/details/106230395)。可以使用 setData()方法来更新页面的数据，让页面重新渲染。

3. [数组删除操作使用了 splice()方法，但是没有注意它会改变原始数组的长度和索引](https://blog.csdn.net/Bat_Reality/article/details/104721839)。可以使用 filter()方法来删除数组中的元素，它不会改变原始数组，而是返回一个新的数组。

虽然这些原因并不符合项目的实际情况，但也提供了思路：1）feed 数组在删除操作后的 js 更新逻辑可能有问题；2）渲染 feed 的模板结构可能有问题，导致删除的条目在模版上没对应

最后经过排查发现 feed 的模版代码中，key 值的设置不正确，导致模版在删除操作时再次渲染数据出错。至于为什么 key 值不对，则是项目的脚手架编译逻辑出现了问题，不在讨论范围。就是这样～
